<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Team Roster Viewer</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #e7effa;
      margin: 20px;
      color: #333;
    }
    h1 { text-align: center; }
    .filters, .legend {
      margin: 10px auto;
      max-width: 1400px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    .filters input, .filters select, .filters button {
      padding: 5px;
      font-size: 14px;
    }
    table {
      width: 95%;
      margin: 20px auto;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 5px;
      text-align: center;
      font-size: 13px;
    }
    th {
      background: #003366;
      color: #fff;
    }
    .legend button {
      border: 1px solid #ccc;
      padding: 4px 10px;
      border-radius: 5px;
      font-size: 12px;
    }
    .s-6 { background: #c0ffc0; }         /* Day */
    .s-15 { background: #b3d9ff; }        /* Afternoon */
    .s-16 { background: #add8e6; }        /* Late */
    .s-17 { background: #e3b3ff; }        /* Evening */
    .s-18 { background: #d3d3ff; }        /* Night */
    .s-X { background: #f5f5f5; }         /* Day Off */
    .s-AL { background: #ffff99; }        /* Annual Leave */
    .s-CT { background: #ffcc66; }        /* Court */
    .s-T { background: #dda0dd; }         /* Training */
    .s-RS { background: #99ccff; }        /* Regional Shield */
    .s-RDO { background: #ffcccc; }       /* Rostered Off */
    .s-LSL { background: #ccffcc; }       /* Long Service Leave */
  </style>
</head>
<body>
  <h1>Team Roster Viewer</h1>
  
  <div class="legend">
    <button class="s-6">6—Day (06:00–16:00)</button>
    <button class="s-15">15—Afternoon (15:00–01:00)</button>
    <button class="s-16">16—Late (16:00–02:00)</button>
    <button class="s-17">17—Evening (17:00–03:00)</button>
    <button class="s-18">18—Night (21:00–07:00)</button>
    <button class="s-X">X—Day Off</button>
    <button class="s-AL">AL—Annual Leave</button>
    <button class="s-CT">CT—Court</button>
    <button class="s-T">T—Training</button>
    <button class="s-RDO">RDO—Rostered Off</button>
    <button class="s-LSL">LSL—Long Service</button>
    <button class="s-RS">RS—Regional Shield</button>
  </div>

  <div class="filters">
    <label for="team">Team:</label>
    <select id="team">
      <option value="All">All Teams</option>
      <option value="1">Team 1</option>
      <option value="2">Team 2</option>
      <option value="3">Team 3</option>
      <option value="4">Team 4</option>
      <option value="5">Team 5</option>
    </select>

    <label for="empSearch">Emp No.:</label>
    <input type="text" id="empSearch" placeholder="e.g. 204140">

    <label for="startDate">Start:</label>
    <input type="date" id="startDate">

    <label for="endDate">End:</label>
    <input type="date" id="endDate">

    <button onclick="loadRoster()">Reload Files</button>
  </div>

  <table id="rosterTable">
    <thead id="tableHead"></thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script>
    let rosterData = [], overrideData = [];

    function loadRoster() {
      Promise.all([
        fetch("roster_template_final.xlsx").then(r => r.blob()),
        fetch("overrides.xlsx").then(r => r.blob())
      ]).then(async ([rosterBlob, overrideBlob]) => {
        const [roster, overrides] = await Promise.all([
          readExcel(rosterBlob),
          readExcel(overrideBlob)
        ]);
        rosterData = roster;
        overrideData = overrides;
        renderTable();
      });
    }

    function readExcel(blob) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = e => {
          const workbook = XLSX.read(e.target.result, {type: 'binary'});
          const sheetName = workbook.SheetNames[0];
          const data = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
          resolve(data);
        };
        reader.readAsBinaryString(blob);
      });
    }

    function renderTable() {
      const team = document.getElementById('team').value;
      const empSearch = document.getElementById('empSearch').value.trim();
      const start = new Date(document.getElementById('startDate').value);
      const end = new Date(document.getElementById('endDate').value);

      const dates = Object.keys(rosterData[0] || {}).filter(k => /^\d{2}\/\d{2}$/.test(k));
      const filteredDates = dates.filter(d => {
        const fullDate = new Date(`2025/${d.split("/").reverse().join("/")}`);
        return (!isNaN(start) ? fullDate >= start : true) &&
               (!isNaN(end) ? fullDate <= end : true);
      });

      const headRow = ["Name", "Emp No.", "Team", ...filteredDates.map(d => d)];
      const headHTML = `<tr>${headRow.map(h => `<th>${h}</th>`).join("")}</tr>`;
      document.getElementById("tableHead").innerHTML = headHTML;

      const body = rosterData
        .filter(r => (team === "All" || r["Team"] == team))
        .filter(r => (empSearch ? r["Emp No."].toString().includes(empSearch) : true))
        .map(r => {
          const row = [`<td>${r["Name"]}</td>`, `<td>${r["Emp No."]}</td>`, `<td>${r["Team"]}</td>`];
          for (const d of filteredDates) {
            const dateISO = `2025-${d.split("/").reverse().join("-")}`;
            const override = overrideData.find(o => o["Emp No."] == r["Emp No."] && o["Date"] === dateISO);
            const value = override ? override["Override Code"] : r[d];
            const cls = `s-${value}`;
            row.push(`<td class="${cls}">${value}</td>`);
          }
          return `<tr>${row.join("")}</tr>`;
        });

      document.getElementById("tableBody").innerHTML = body.join("");
    }

    // Auto-load on startup
    loadRoster();
  </script>
</body>
</html>
